# ðŸš€ Redis å­¦ä¹ ç¬”è®°ï¼šList ç±»åž‹è¯¦è§£ä¸Ž Golang åº”ç”¨

Redis çš„ List ç±»åž‹æ˜¯ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²å…ƒç´ é›†åˆï¼Œå…¶åº•å±‚å®žçŽ°æ˜¯åŒå‘é“¾è¡¨ (Linked List)ï¼ˆåœ¨ Redis 3.2 ä»¥å‰æ˜¯ `ziplist` æˆ– `linkedlist`ï¼Œæ–°ç‰ˆæœ¬ä½¿ç”¨ `quicklist` ä¼˜åŒ–äº†å†…å­˜å’Œæ€§èƒ½ï¼‰ã€‚List ç±»åž‹çš„è®¾è®¡éžå¸¸ç²¾å·§ï¼Œå®ƒæ—¢å¯ä»¥ä½œä¸ºæ ˆ (Stack)ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé˜Ÿåˆ— (Queue)ï¼Œæ»¡è¶³äº†å¤§é‡åº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚

## 1. List ç±»åž‹æ¦‚è§ˆ

### 1.1 æ•°æ®ç»“æž„ç‰¹æ€§
- **æœ‰åºæ€§**ï¼š å…ƒç´ æŒ‰ç…§æ’å…¥é¡ºåºæŽ’åˆ—ã€‚
- **é‡å¤æ€§**ï¼š åˆ—è¡¨ä¸­å¯ä»¥åŒ…å«é‡å¤çš„å…ƒç´ ã€‚
- **åŒç«¯æ“ä½œ**ï¼š æ”¯æŒä»Žåˆ—è¡¨çš„å·¦ä¾§ï¼ˆå¤´éƒ¨ï¼‰å’Œå³ä¾§ï¼ˆå°¾éƒ¨ï¼‰è¿›è¡Œå…ƒç´ çš„æ·»åŠ å’Œç§»é™¤ï¼Œæ“ä½œé€Ÿåº¦å‡ä¸º $O(1)$ã€‚

### 1.2 Golang/Java ç±»æ¯”

| Redis List æ“ä½œ | Golang æ¦‚å¿µ | Java æ¦‚å¿µ |
| :--- | :--- | :--- |
| `RPUSH`/`LPOP` | FIFO é˜Ÿåˆ— (Queue) | `Queue`/`LinkedList` |
| `LPUSH`/`LPOP` | LIFO æ ˆ (Stack) | `Stack`/`Deque` |
| `LRANGE`/`LINDEX` | æ™®é€šåˆ—è¡¨ (List) | `List`/`Slice` |

## 2. List ç±»åž‹å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤æ ¼å¼ | åŠŸèƒ½æè¿° | ç¤ºä¾‹ | æ ˆ/é˜Ÿåˆ—è§’è‰² |
| :--- | :--- | :--- | :--- |
| `RPUSH key value [v...]` | ä»Žå³è¾¹ï¼ˆå°¾éƒ¨ï¼‰å¾€é›†åˆä¸­æ·»åŠ å€¼ã€‚ | `RPUSH Skill html golang` | é˜Ÿåˆ—å…¥é˜Ÿ/åˆ—è¡¨è¿½åŠ  |
| `LPUSH key value [v...]` | ä»Žå·¦è¾¹ï¼ˆå¤´éƒ¨ï¼‰å¾€é›†åˆä¸­æ·»åŠ å€¼ã€‚ | `LPUSH Skill JavaScript` | æ ˆå…¥æ ˆ/åˆ—è¡¨å‰ç½® |
| `LPOP key` | å¼¹å‡ºå¹¶è¿”å›žé›†åˆä¸­æœ€å·¦è¾¹ï¼ˆå¤´éƒ¨ï¼‰çš„æ•°æ®ã€‚ | `LPOP Skill` | é˜Ÿåˆ—å‡ºé˜Ÿ/æ ˆå‡ºæ ˆ |
| `RPOP key` | å¼¹å‡ºå¹¶è¿”å›žé›†åˆä¸­æœ€å³è¾¹ï¼ˆå°¾éƒ¨ï¼‰çš„æ•°æ®ã€‚ | `RPOP Skill` | |
| `LRANGE key start stop` | èŽ·å–æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚ | `LRANGE Skill 0 -1` | åˆ—è¡¨æŸ¥è¯¢ |
| `LLEN key` | èŽ·å–åˆ—è¡¨çš„é•¿åº¦ã€‚ | `LLEN Skill` | |

## 3. List ç±»åž‹éžå¸¸ç”¨å‘½ä»¤

| å‘½ä»¤æ ¼å¼ | åŠŸèƒ½æè¿° | ç¤ºä¾‹ | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- |
| `LINSERT key BEFORE\|AFTER pivot value` | åœ¨åˆ—è¡¨ä¸­æŒ‡å®š `pivot` å…ƒç´ ä¹‹å‰/ä¹‹åŽæ’å…¥ `value`ã€‚ | `LINSERT Skill before golang CSS` | å¦‚æžœ `pivot` ä¸å­˜åœ¨ï¼Œä¸æ‰§è¡Œæ“ä½œã€‚ |
| `LSET key index value` | æ›´æ–°ç´¢å¼• `index` ä½ç½®çš„å€¼ä¸º `value`ã€‚ | `LSET Skill 5 Solidity` | $O(N)$ æ“ä½œï¼Œåº”é¿å…å¯¹å¤§åˆ—è¡¨é¢‘ç¹ä½¿ç”¨ã€‚ |
| `LREM key count value` | ä»Žåˆ—è¡¨ä¸­ç§»é™¤ `count` ä¸ªç­‰äºŽ `value` çš„å…ƒç´ ã€‚ | `LREM Skill 3 Solidity` | `count > 0` (ä»Žå·¦ç§»é™¤)ï¼Œ`count < 0` (ä»Žå³ç§»é™¤)ï¼Œ`count = 0` (ç§»é™¤æ‰€æœ‰)ã€‚ |
| `LTRIM key start stop` | æˆªå–åˆ—è¡¨ï¼Œåªä¿ç•™ `start` åˆ° `stop` èŒƒå›´å†…çš„å…ƒç´ ã€‚ | `LTRIM Skill 3 5` | **é‡è¦**ï¼šå¸¸ç”¨äºŽé™åˆ¶åˆ—è¡¨é•¿åº¦ï¼ˆå¦‚æœ€æ–°Næ¡æ•°æ®ï¼‰ã€‚ |
| `LINDEX key index` | èŽ·å–ç´¢å¼•ä¸º `index` ä½ç½®çš„æ•°æ®ã€‚ | `LINDEX Skill 0` | $O(N)$ æ“ä½œï¼Œåº”é¿å…å¯¹å¤§åˆ—è¡¨é¢‘ç¹ä½¿ç”¨ã€‚ |

## 4. ç»å…¸åº”ç”¨åœºæ™¯

### 4.1 æ¶ˆæ¯é˜Ÿåˆ— (Message Queue)

List æ˜¯å®žçŽ°ç®€å•æ¶ˆæ¯é˜Ÿåˆ—çš„å¤©ç„¶é€‰æ‹©ï¼Œå…·æœ‰ **åŽŸå­æ€§** å’Œ **é˜»å¡žæ“ä½œ** çš„ç‰¹æ€§ã€‚

- **ç”Ÿäº§è€… (Producer)**ï¼š ä½¿ç”¨ `LPUSH` æˆ– `RPUSH` å°†æ¶ˆæ¯æŽ¨å…¥åˆ—è¡¨ã€‚
- **æ¶ˆè´¹è€… (Consumer)**ï¼š ä½¿ç”¨ `LPOP` æˆ– `RPOP` å–å‡ºæ¶ˆæ¯ã€‚
- **é˜»å¡žé˜Ÿåˆ—**ï¼š ä½¿ç”¨ `BLPOP` / `BRPOP` å®žçŽ°é˜»å¡žå¼å¼¹å‡ºã€‚å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…ä¼šé˜»å¡žç­‰å¾…æ–°æ¶ˆæ¯ï¼Œç›´åˆ°è¶…æ—¶æˆ–æœ‰æ–°æ¶ˆæ¯åˆ°æ¥ï¼Œæœ‰æ•ˆé¿å…äº† CPU ç©ºè½®è¯¢ã€‚

**å‘½ä»¤ç¤ºä¾‹ï¼ˆé˜»å¡žæ¶ˆè´¹ï¼‰ï¼š**
```redis
// BRPOP key [key ...] timeout
BRPOP task:queue 0  // é˜»å¡žç­‰å¾…ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯æˆ–æœåŠ¡å™¨å…³é—­
```

### 4.2 æ ˆä¸Žæœ€æ–°åˆ—è¡¨ (Feed/Timeline)

List å¯ç”¨äºŽå­˜å‚¨ç”¨æˆ·åŠ¨æ€æˆ–æœ€æ–°æ¶ˆæ¯æµï¼Œå¦‚å¾®åš Timelineã€‚

- **åœºæ™¯**ï¼š ç”¨æˆ·æ”¶è—æ–‡ç« åˆ—è¡¨ã€æœ€æ–°è´­ä¹°è®°å½•ã€æ“ä½œæ—¥å¿—ã€‚
- **å®žçŽ°**ï¼š ä½¿ç”¨ `LPUSH` ä¿è¯æœ€æ–°æ·»åŠ çš„å…ƒç´ å§‹ç»ˆåœ¨åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆç´¢å¼• 0ï¼‰ã€‚

**å‘½ä»¤ç¤ºä¾‹ï¼š**
```redis
// æ·»åŠ æœ€æ–°æ–‡ç«  ID åˆ°åˆ—è¡¨å¤´éƒ¨
LPUSH user:favor:article:1001 aid_300
LPUSH user:favor:article:1001 aid_299

// æŸ¥çœ‹æœ€è¿‘çš„ 10 ç¯‡æ–‡ç«  ID
LRANGE user:favor:article:1001 0 9

// é…åˆ LTRIM é™åˆ¶åˆ—è¡¨é•¿åº¦ï¼Œåªä¿ç•™æœ€æ–°çš„ 1000 æ¡
LTRIM user:favor:article:1001 0 999
```

## 5. Golang å®¢æˆ·ç«¯æ“ä½œ List ç¤ºä¾‹

åœ¨ Golang ä¸­ï¼Œä½¿ç”¨ `go-redis/redis/v9` åº“æ“ä½œ List ç±»åž‹ï¼š

```go
package main

import (
	"context"
	"fmt"
	"github.com/redis/go-redis/v9"
)

var ctx = context.Background()
// å‡è®¾ rdb å·²ç»åˆå§‹åŒ–å¹¶è¿žæŽ¥æˆåŠŸ

func listExample(rdb *redis.Client) {
    listKey := "task:queue:sync"
    
    // 1. RPUSH/LPUSH æ·»åŠ å…¥é˜Ÿ
    rdb.RPush(ctx, listKey, "task_1", "task_2", "task_3")
    rdb.LPush(ctx, listKey, "task_0") 
    // é˜Ÿåˆ—å½“å‰çŠ¶æ€: ["task_0", "task_1", "task_2", "task_3"]

    // 2. LRANGE æŸ¥çœ‹åˆ—è¡¨æ‰€æœ‰å…ƒç´ 
    all, _ := rdb.LRange(ctx, listKey, 0, -1).Result()
    fmt.Printf("å½“å‰é˜Ÿåˆ—: %v\n", all)

    // 3. LPOP/RPOP å‡ºé˜Ÿ
    leftPop, _ := rdb.LPop(ctx, listKey).Result()
    rightPop, _ := rdb.RPop(ctx, listKey).Result()
    fmt.Printf("LPOP (å·¦å‡º): %s, RPOP (å³å‡º): %s\n", leftPop, rightPop)
    // é˜Ÿåˆ—å½“å‰çŠ¶æ€: ["task_1", "task_2"]

    // 4. BLPOP é˜»å¡žå¼¹å‡º (æ¼”ç¤ºï¼šåœ¨å®žé™…åº”ç”¨ä¸­é€šå¸¸æ˜¯å•ç‹¬çš„æ¶ˆè´¹è€…æœåŠ¡è°ƒç”¨)
    // rdb.BLPop(ctx, 5*time.Second, listKey) 
    // é˜»å¡ž 5 ç§’ç­‰å¾…æ–°ä»»åŠ¡
    
    // 5. LTRIM é™åˆ¶é•¿åº¦
    rdb.RPush(ctx, listKey, "a", "b", "c", "d", "e") // é˜Ÿåˆ—å˜é•¿
    rdb.LTrim(ctx, listKey, 0, 3) // åªä¿ç•™å‰ 4 ä¸ªå…ƒç´  (0, 1, 2, 3)
    trimmed, _ := rdb.LRange(ctx, listKey, 0, -1).Result()
    fmt.Printf("LTRIM åŽé˜Ÿåˆ—: %v\n", trimmed)
}
```
