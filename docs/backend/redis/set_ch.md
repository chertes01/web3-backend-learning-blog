# ğŸš€ Redis å­¦ä¹ ç¬”è®°ï¼šSet ç±»å‹è¯¦è§£ä¸ Golang åº”ç”¨

Redis çš„ Setï¼ˆé›†åˆï¼‰ç±»å‹æ˜¯ä¸€ä¸ª **æ— åº** çš„å­—ç¬¦ä¸²å…ƒç´ é›†åˆã€‚å…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯å…ƒç´ çš„å”¯ä¸€æ€§ï¼Œåº•å±‚é€šè¿‡ **å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰** å®ç°ï¼Œå› æ­¤å…ƒç´ çš„æ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å‡ä¸º $O(1)$ã€‚Set ç±»å‹æ˜¯ Redis ä¸­ç”¨äºå¤„ç†æ•°å­¦é›†åˆè¿ç®—ï¼ˆäº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼‰æœ€ç†æƒ³çš„æ•°æ®ç»“æ„ã€‚

## 1. Set ç±»å‹æ¦‚è§ˆ

### 1.1 æ•°æ®ç»“æ„ç‰¹æ€§
- **æ— åºæ€§**ï¼š å…ƒç´ æ²¡æœ‰å›ºå®šçš„é¡ºåºã€‚
- **å”¯ä¸€æ€§**ï¼š é›†åˆä¸­ä¸å…è®¸å‡ºç°é‡å¤çš„æˆå‘˜ï¼ˆMembersï¼‰ã€‚
- **é«˜æ•ˆæ“ä½œ**ï¼š æ·»åŠ ã€ç§»é™¤ã€åˆ¤æ–­æˆå‘˜æ˜¯å¦å­˜åœ¨éƒ½éå¸¸å¿« ($O(1)$)ã€‚

### 1.2 Golang/Java ç±»æ¯”

| Redis Set æ“ä½œ | Golang æ¦‚å¿µ | Java æ¦‚å¿µ |
| :--- | :--- | :--- |
| æ•´ä½“ç»“æ„ | `map[string]struct{}` (åˆ©ç”¨ map key çš„å”¯ä¸€æ€§) | `Set` / `HashSet` |
| æˆå‘˜æ“ä½œ | `len(set)` | `Set.add()`, `Set.remove()`, `Set.contains()` |

## 2. Set ç±»å‹å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤æ ¼å¼ | åŠŸèƒ½æè¿° | ç¤ºä¾‹ | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- |
| `SADD key member [member ...]` | å¾€ Key é›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜å…ƒç´ ã€‚ | `SADD user Alice Frank Tom` | é‡å¤æ·»åŠ çš„å…ƒç´ ä¼šè¢«å¿½ç•¥ã€‚ |
| `SMEMBERS key` | éå† Key é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ | `SMEMBERS user` | **æ³¨æ„**ï¼š é›†åˆå¾ˆå¤§æ—¶ï¼Œå¯èƒ½ä¼šé˜»å¡æœåŠ¡å™¨ã€‚ |
| `SREM key member [member ...]` | åˆ é™¤ Key é›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜å…ƒç´ ã€‚ | `SREM user Tim` | |
| `SPOP key [count]` | ä» Key é›†åˆä¸­éšæœºå¼¹å‡ºå¹¶è¿”å› `count` ä¸ªå…ƒç´ ã€‚ | `SPOP user 1` | å¼¹å‡ºçš„å…ƒç´ å°†ä»é›†åˆä¸­åˆ é™¤ã€‚ |
| `SCARD key` | è·å–é›†åˆä¸­å…ƒç´ çš„æ•°é‡ï¼ˆCardinalityï¼‰ã€‚ | `SCARD user` | |
| `SISMEMBER key member` | åˆ¤æ–­ `member` å…ƒç´ æ˜¯å¦åœ¨ Key é›†åˆä¸­ã€‚ | `SISMEMBER user Tim` | è¿”å› 1 (æ˜¯) æˆ– 0 (å¦)ã€‚ |

## 3. Set ç±»å‹é›†åˆè¿ç®—å‘½ä»¤

Set ç±»å‹æä¾›äº†ä¸€å¥—å®Œæ•´çš„é›†åˆè¿ç®—å‘½ä»¤ï¼Œè¿™æ˜¯å…¶æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚

| å‘½ä»¤æ ¼å¼ | åŠŸèƒ½æè¿° | ç¤ºä¾‹ | åœºæ™¯ |
| :--- | :--- | :--- | :--- |
| `SDIFF key1 key2 [key3...]` | è¿”å› `key1` ä¸­ç‹¬æœ‰çš„å…ƒç´ ï¼ˆå·®é›†ï¼‰ã€‚ | `SDIFF user student` | æŸ¥æ‰¾â€œåªå…³æ³¨ç”¨æˆ·ä½†æ²¡æœ‰å…³æ³¨å­¦ç”Ÿâ€çš„äººã€‚ |
| `SINTER key1 key2 [key3...]` | è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å…±æœ‰å…ƒç´ ï¼ˆäº¤é›†ï¼‰ã€‚ | `SINTER user student` | æŸ¥æ‰¾â€œæ—¢æ˜¯ç”¨æˆ·åˆæ˜¯å­¦ç”Ÿâ€çš„äººï¼ˆå…±åŒå…³æ³¨ï¼‰ã€‚ |
| `SUNION key1 key2 [key3...]` | è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„åˆå¹¶ç»“æœï¼ˆå¹¶é›†ï¼‰ã€‚ | `SUNION user student` | æŸ¥æ‰¾â€œå…³æ³¨ç”¨æˆ·æˆ–å…³æ³¨å­¦ç”Ÿâ€çš„æ‰€æœ‰äººã€‚ |
| `S*STORE dest key1 key2...` | æ‰§è¡Œä¸Šè¿°è¿ç®—ï¼ˆ`SDIFFSTORE`, `SINTERSTORE`, `SUNIONSTORE`ï¼‰ï¼Œå¹¶å°†ç»“æœç¼“å­˜åˆ° `dest` é›†åˆä¸­ã€‚ | `SINTERSTORE desk user student` | ç¼“å­˜é›†åˆè¿ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—ã€‚ |

## 4. Set ç±»å‹éå¸¸ç”¨å‘½ä»¤

| å‘½ä»¤æ ¼å¼ | åŠŸèƒ½æè¿° | ç¤ºä¾‹ | å¤‡æ³¨ |
| :--- | :--- | :--- | :--- |
| `SRANDMEMBER key [count]` | éšæœºè·å– `count` ä¸ªå…ƒç´ ï¼Œä½†ä¸ä»é›†åˆä¸­åˆ é™¤ã€‚ | `SRANDMEMBER user 3` | |
| `SMOVE source destination member` | å°† `source` é›†åˆä¸­çš„ `member` å…ƒç´ åŸå­æ€§åœ°ç§»åŠ¨åˆ° `destination` é›†åˆã€‚ | `SMOVE user destination Tim` | å¸¸ç”¨äºçŠ¶æ€è½¬ç§»ã€‚ |

## 5. ç»å…¸åº”ç”¨åœºæ™¯

### 5.1 æ•°æ®å»é‡

åˆ©ç”¨ Set é›†åˆçš„å”¯ä¸€æ€§ï¼Œå¯ä»¥è½»æ¾å®ç°æ•°æ®å»é‡ã€‚

- **åœºæ™¯**ï¼š ç»Ÿè®¡ç½‘ç«™ç‹¬ç«‹ IP è®¿é—®é‡ï¼ˆUV - Unique Visitorï¼‰ã€ç”¨æˆ·æ¯æ—¥æ‰“å¡å»é‡ã€‚
- **å®ç°**ï¼š æ¯æ¬¡è®¿é—®æˆ–æ‰“å¡æ—¶ï¼Œå°†ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ IP æˆ– UserIDï¼‰ä½¿ç”¨ `SADD` åŠ å…¥ Set é›†åˆã€‚æœ€ç»ˆä½¿ç”¨ `SCARD` è·å–é›†åˆå¤§å°ï¼Œå³ä¸ºå»é‡åçš„æ•°é‡ã€‚

**å‘½ä»¤ç¤ºä¾‹ï¼š**
```redis
SADD unique:visitors:20251025 192.168.1.1 192.168.1.5
SCARD unique:visitors:20251025  // è·å–ä»Šæ—¥ UV æ•°é‡
```

### 5.2 ç¤¾äº¤å…³ç³»ä¸å…±åŒå¥½å‹

é›†åˆè¿ç®—æ˜¯å¤„ç†ç¤¾äº¤å…³ç³»çš„æ ¸å¿ƒå·¥å…·ã€‚

- **åœºæ™¯**ï¼š å…±åŒå…³æ³¨ã€å¥½å‹æ¨èã€ç”¨æˆ·æ ‡ç­¾ç³»ç»Ÿã€‚
- **å®ç°**ï¼š æ¯ä¸ªç”¨æˆ·å…³æ³¨çš„å¥½å‹åˆ—è¡¨å­˜å‚¨ä¸ºä¸€ä¸ª Setã€‚

**å‘½ä»¤ç¤ºä¾‹ï¼š**
```redis
// æŸ¥æ‰¾ user:alice å’Œ user:bob çš„å…±åŒå¥½å‹ï¼ˆäº¤é›†ï¼‰
SINTER user:alice:follows user:bob:follows

// æŸ¥æ‰¾ user:alice å…³æ³¨äº†ä½† user:bob æ²¡æœ‰å…³æ³¨çš„äººï¼ˆå·®é›†ï¼‰
SDIFF user:alice:follows user:bob:follows
```

### 5.3 éšæœºæŠ½å¥–

åˆ©ç”¨ `SPOP` çš„éšæœºæ€§å’Œå¼¹å‡ºç‰¹æ€§ï¼Œå¯ä»¥é«˜æ•ˆå®‰å…¨åœ°è¿›è¡ŒæŠ½å¥–æ´»åŠ¨ã€‚

- **åœºæ™¯**ï¼š æŠ½å– N ç­‰å¥–ã€éšæœºåˆ†é…ä»»åŠ¡ã€‚
- **å®ç°**ï¼š å¥–æ± æˆ–å‚ä¸è€…åˆ—è¡¨ä½¿ç”¨ Set å­˜å‚¨ï¼Œä½¿ç”¨ `SPOP` æŠ½å–ã€‚

**å‘½ä»¤ç¤ºä¾‹ï¼š**
```redis
// 1. å‡†å¤‡æŠ½å¥–æ± 
SADD luckydraw 1 2 3 ... 100

// 2. æŠ½å– 3 ä¸ªä¸‰ç­‰å¥–ï¼ˆå¹¶ä»å¥–æ± ä¸­ç§»é™¤ï¼‰
SPOP luckydraw 3

// 3. æŠ½å– 1 ä¸ªä¸€ç­‰å¥–
SPOP luckydraw 1
```

## 6. Golang å®¢æˆ·ç«¯æ“ä½œ Set ç¤ºä¾‹

åœ¨ Golang ä¸­ï¼Œä½¿ç”¨ `go-redis/redis/v9` åº“æ“ä½œ Set ç±»å‹ï¼š

```go
package main

import (
	"context"
	"fmt"
	"github.com/redis/go-redis/v9"
)

var ctx = context.Background()
// å‡è®¾ rdb å·²ç»åˆå§‹åŒ–å¹¶è¿æ¥æˆåŠŸ

func setExample(rdb *redis.Client) {
    userSet := "set:user:followers"
    studentSet := "set:student:members"
    
    // 1. SADD æ·»åŠ æˆå‘˜
    rdb.SAdd(ctx, userSet, "Alice", "Frank", "Tom", "Tim")
    rdb.SAdd(ctx, studentSet, "Hans", "Trump", "Tom", "Tim")
    
    // 2. SISMEMBER åˆ¤æ–­æˆå‘˜æ˜¯å¦å­˜åœ¨
    isMember, _ := rdb.SIsMember(ctx, userSet, "Alice").Result()
    fmt.Printf("Alice æ˜¯å¦åœ¨ userSet ä¸­: %v\n", isMember) // true

    // 3. SINTER è®¡ç®—äº¤é›†
    commonMembers, _ := rdb.SInter(ctx, userSet, studentSet).Result()
    fmt.Printf("å…±åŒæˆå‘˜ (äº¤é›†): %v\n", commonMembers) 
    // è¾“å‡º: [Tom Tim]

    // 4. SDIFF è®¡ç®—å·®é›†
    diffMembers, _ := rdb.SDiff(ctx, userSet, studentSet).Result()
    fmt.Printf("userSet ç‹¬æœ‰æˆå‘˜ (å·®é›†): %v\n", diffMembers) 
    // è¾“å‡º: [Alice Frank]

    // 5. SPOP éšæœºå¼¹å‡º
    spopMember, _ := rdb.SPop(ctx, userSet).Result() // éšæœºå¼¹å‡ºä¸€ä¸ªï¼Œå¹¶ä»é›†åˆä¸­ç§»é™¤
    fmt.Printf("SPOP å¼¹å‡ºçš„æˆå‘˜: %s\n", spopMember)

    // 6. SCARD è·å–æ•°é‡
    cardinality, _ := rdb.SCard(ctx, userSet).Result()
    fmt.Printf("userSet å‰©ä½™æˆå‘˜æ•°é‡: %d\n", cardinality)
}
```