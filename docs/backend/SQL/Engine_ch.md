# ðŸ§© MySQL å­˜å‚¨å¼•æ“Žå­¦ä¹ ç¬”è®°

---

## ä¸€ã€å­˜å‚¨å¼•æ“Žç®€ä»‹

å­˜å‚¨å¼•æ“Žï¼ˆStorage Engineï¼‰æ˜¯ MySQL ç”¨äºŽç®¡ç†è¡¨æ•°æ®å’Œç´¢å¼•çš„åº•å±‚æ¨¡å—ã€‚  
æ¯ä¸ªè¡¨éƒ½å¯ä»¥ç‹¬ç«‹é€‰æ‹©å¼•æ“Žï¼ˆå¦‚ InnoDBã€MyISAMã€Memory ç­‰ï¼‰ã€‚

---

## äºŒã€æŸ¥çœ‹ä¸Žè®¾ç½®å­˜å‚¨å¼•æ“Ž

| æ“ä½œ         | SQL è¯­å¥                                         | è¯´æ˜Ž                       |
|--------------|--------------------------------------------------|----------------------------|
| æŸ¥çœ‹æ”¯æŒçš„å¼•æ“Ž | `SHOW ENGINES;`                                 | æŸ¥çœ‹å½“å‰ MySQL æ”¯æŒå“ªäº›å¼•æ“Ž |
| æŸ¥çœ‹æŸè¡¨å¼•æ“Ž  | `SHOW TABLE STATUS LIKE 'table_name'\G`         | åŒ…æ‹¬ ENGINEã€è¡Œæ ¼å¼ã€è¡Œæ•°ç­‰ |
| è®¾ç½®é»˜è®¤å¼•æ“Ž  | `SET GLOBAL default_storage_engine = 'InnoDB';` | ä¿®æ”¹å…¨å±€é»˜è®¤å€¼              |
| åˆ›å»ºè¡¨æŒ‡å®šå¼•æ“Ž| `CREATE TABLE test(id INT) ENGINE=InnoDB;`      | ä»…å½±å“è¯¥è¡¨                  |
| ä¿®æ”¹è¡¨å¼•æ“Ž    | `ALTER TABLE test ENGINE=MyISAM;`               | æœ‰æ‹·è´æ“ä½œï¼Œæ…Žç”¨å¤§è¡¨        |

---

## ä¸‰ã€å¸¸è§å­˜å‚¨å¼•æ“Žå¯¹æ¯”è¡¨

| ç‰¹æ€§         | InnoDB | MyISAM | Memory | Archive | Blackhole | NDB Cluster |
|--------------|--------|--------|--------|---------|-----------|-------------|
| äº‹åŠ¡æ”¯æŒ     | âœ…     | âŒ     | âŒ     | âŒ      | âŒ        | âœ…ï¼ˆéƒ¨åˆ†ï¼‰   |
| é”ç²’åº¦       | è¡Œçº§é” | è¡¨çº§é” | è¡¨çº§é” | è¡Œé”ï¼ˆä»…æ’å…¥ï¼‰ | æ— é” | è¡Œçº§é”      |
| å¤–é”®æ”¯æŒ     | âœ…     | âŒ     | âŒ     | âŒ      | âŒ        | éƒ¨åˆ†æ”¯æŒ     |
| å´©æºƒæ¢å¤     | âœ…     | âŒ     | âŒ     | âœ…      | âŒ        | âœ…           |
| å…¨æ–‡ç´¢å¼•     | âœ…     | âœ…     | âŒ     | âŒ      | âŒ        | âŒ           |
| ç´¢å¼•ç±»åž‹     | B+Tree | B+Tree | Hash/BTree | æ— æˆ–æžå°‘ | æ—  | Hash/BTree   |
| æ•°æ®å­˜å‚¨ä½ç½® | ç£ç›˜   | ç£ç›˜   | å†…å­˜   | ç£ç›˜ï¼ˆåŽ‹ç¼©ï¼‰ | æ— å­˜å‚¨ | åˆ†å¸ƒå¼èŠ‚ç‚¹  |
| æ–‡ä»¶ç»“æž„     | .ibd   | .MYD/.MYI/.frm | å†…å­˜ä¸­ | .ARZ | æ—  | åˆ†å¸ƒå¼å­˜å‚¨   |
| è¯»å–æ€§èƒ½     | â­â­â­   | â­â­â­â­  | â­â­â­â­â­ | â­â­     | âŒ        | â­â­           |
| å†™å…¥æ€§èƒ½     | â­â­â­â­  | â­â­    | â­â­â­â­  | â­â­     | â­â­        | â­â­â­          |
| æ˜¯å¦æŒä¹…åŒ–   | âœ…     | âœ…     | âŒ     | âœ…      | âŒ        | âœ…           |
| é€‚ç”¨åœºæ™¯     | OLTP/äº‹åŠ¡ | æŠ¥è¡¨/åªè¯» | ä¸´æ—¶è¡¨/ç¼“å­˜ | æ—¥å¿—å½’æ¡£ | å¤åˆ¶é“¾æµ‹è¯• | åˆ†å¸ƒå¼é«˜å¯ç”¨ |
| å¤‡æ³¨         | é»˜è®¤å¼•æ“Ž | æ—§ç‰ˆæœ¬å¸¸ç”¨ | é‡å¯å³ä¸¢å¤± | ä»…æ’å…¥å’ŒæŸ¥è¯¢ | æ— æ•°æ®å­˜å‚¨ | å¤æ‚éœ€å¤šèŠ‚ç‚¹ |

---

## å››ã€å„å¼•æ“Žè¯¦è§£

### 1ï¸âƒ£ InnoDB â€” é»˜è®¤ä¸ŽæŽ¨èå¼•æ“Ž

- **äº‹åŠ¡æ”¯æŒ**ï¼šå®Œæ•´æ”¯æŒ ACIDï¼Œå…·å¤‡ redo/undo æ—¥å¿—
- **é”æœºåˆ¶**ï¼šè¡Œçº§é” + MVCCï¼Œå¤šç”¨æˆ·å¹¶å‘æ€§èƒ½å¥½
- **å¤–é”®æ”¯æŒ**ï¼šæ”¯æŒå¤–é”®çº¦æŸ
- **æ–‡ä»¶ç»“æž„**ï¼š.ibd æ–‡ä»¶ï¼ˆæ¯è¡¨ç‹¬ç«‹ï¼‰æˆ–å…±äº«è¡¨ç©ºé—´
- **æ¢å¤èƒ½åŠ›**ï¼šå´©æºƒåŽè‡ªåŠ¨æ¢å¤ï¼ˆåŸºäºŽæ—¥å¿—ï¼‰
- **é€‚åˆåœºæ™¯**ï¼šéœ€è¦äº‹åŠ¡ã€å¹¶å‘é«˜ã€å®‰å…¨æ€§è¦æ±‚é«˜çš„ç³»ç»Ÿ
- **å…³é”®å‚æ•°**ï¼šinnodb_buffer_pool_sizeã€innodb_log_file_sizeã€innodb_flush_log_at_trx_commit

ðŸ“Œ ä¼˜ç‚¹ï¼šäº‹åŠ¡å®‰å…¨ã€æ•°æ®å¯é ã€è¡Œçº§é”å‡å°‘é˜»å¡žã€æ”¯æŒå¤–é”®ä¸Žå…¨æ–‡ç´¢å¼•  
âš ï¸ æ³¨æ„ï¼šå ç”¨æ›´å¤šå†…å­˜ï¼Œäº‹åŠ¡æ—¥å¿—ä¼šå ç£ç›˜ç©ºé—´

---

### 2ï¸âƒ£ MyISAM â€” æ—©æœŸé»˜è®¤å¼•æ“Ž

- **äº‹åŠ¡æ”¯æŒ**ï¼šä¸æ”¯æŒ
- **é”æœºåˆ¶**ï¼šè¡¨çº§é”ï¼ˆè¯»å†™äº’æ–¥ï¼‰
- **æ–‡ä»¶ç»“æž„**ï¼š.MYDï¼ˆæ•°æ®ï¼‰ + .MYIï¼ˆç´¢å¼•ï¼‰ + .frmï¼ˆè¡¨å®šä¹‰ï¼‰
- **å´©æºƒæ¢å¤**ï¼šéœ€æ‰‹åŠ¨ REPAIR TABLE
- **é€‚åˆåœºæ™¯**ï¼šè¯»å¤šå†™å°‘ã€æ•°æ®é‡å¤§ã€ä½Žå¹¶å‘åº”ç”¨
- **ç‰¹æ®ŠåŠŸèƒ½**ï¼šæ”¯æŒ FULLTEXT ç´¢å¼•ã€åŽ‹ç¼©è¡¨

ðŸ“Œ ä¼˜ç‚¹ï¼šè¯»æ€§èƒ½é«˜ã€æ–‡ä»¶æ˜“å¤åˆ¶/è¿ç§»  
âš ï¸ ç¼ºç‚¹ï¼šæ— äº‹åŠ¡ã€æ— å¤–é”®ã€å¹¶å‘å†™å…¥æ€§èƒ½å·®

---

### 3ï¸âƒ£ MEMORYï¼ˆHEAPï¼‰â€” å†…å­˜è¡¨

- **å­˜å‚¨ä½ç½®**ï¼šå…¨éƒ¨åœ¨å†…å­˜ä¸­ï¼ˆéžæŒä¹…ï¼‰
- **ç´¢å¼•ç±»åž‹**ï¼šé»˜è®¤ HASHï¼Œå¯æ”¹ä¸º BTREE
- **äº‹åŠ¡æ”¯æŒ**ï¼šä¸æ”¯æŒ
- **è¡Œæ ¼å¼**ï¼šå®šé•¿ï¼Œæµªè´¹éƒ¨åˆ†å†…å­˜
- **æ–‡ä»¶ç»“æž„**ï¼šæ— ï¼Œé‡å¯åŽæ•°æ®ä¸¢å¤±
- **é™åˆ¶**ï¼šå— max_heap_table_size å’Œ tmp_table_size é™åˆ¶
- **é€‚åˆåœºæ™¯**ï¼šä¸´æ—¶è¡¨ã€ç¼“å­˜è¡¨ã€ä¼šè¯è¡¨ã€æ•°æ®ä¸­è½¬

âš ï¸ æ³¨æ„ï¼šæœåŠ¡å™¨é‡å¯å³ä¸¢å¤±æ•°æ®ï¼Œä¸æ”¯æŒ TEXT/BLOB ç±»åž‹

---

### 4ï¸âƒ£ ARCHIVE â€” åŽ‹ç¼©å½’æ¡£å¼•æ“Ž

- **åŠŸèƒ½**ï¼šä»…æ”¯æŒ INSERT å’Œ SELECT
- **å­˜å‚¨æ–¹å¼**ï¼šé«˜åŽ‹ç¼©æ¯”ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´
- **ç´¢å¼•æ”¯æŒ**ï¼šæžå°‘ï¼ˆé€šå¸¸ä¸æ”¯æŒå¤æ‚ç´¢å¼•ï¼‰
- **é€‚åˆåœºæ™¯**ï¼šæ—¥å¿—å½’æ¡£ã€åŽ†å²è®°å½•ä¿å­˜

âš ï¸ æ³¨æ„ï¼šæŸ¥è¯¢æ…¢ï¼ˆå…¨è¡¨æ‰«æï¼‰ï¼Œä¸æ”¯æŒ DELETE/UPDATE

---

### 5ï¸âƒ£ BLACKHOLE â€” æ•°æ®é»‘æ´ž

- **åŠŸèƒ½**ï¼šæŽ¥æ”¶å†™å…¥ä½†ä¸å­˜å‚¨ä»»ä½•æ•°æ®
- **ç”¨é€”**ï¼šå¤åˆ¶é“¾è·¯ä¸­ç»§ã€æ—¥å¿—æµé‡åˆ†æž
- **å­˜å‚¨æ–‡ä»¶**ï¼šæ— å®žé™…æ•°æ®æ–‡ä»¶

ðŸ’¡ é€‚åˆæµ‹è¯•å†™å…¥æµé‡æˆ–ç”¨äºŽä¸»ä»Žå¤åˆ¶çš„ä¸­è½¬èŠ‚ç‚¹ã€‚

---

### 6ï¸âƒ£ NDB Cluster â€” åˆ†å¸ƒå¼é«˜å¯ç”¨å¼•æ“Ž

- **æž¶æž„**ï¼šæ•°æ®èŠ‚ç‚¹ + ç®¡ç†èŠ‚ç‚¹ + SQL èŠ‚ç‚¹
- **ç‰¹æ€§**ï¼šé«˜å¯ç”¨ã€åˆ†å¸ƒå¼å­˜å‚¨ã€è‡ªåŠ¨åˆ†ç‰‡
- **äº‹åŠ¡æ”¯æŒ**ï¼šéƒ¨åˆ†æ”¯æŒï¼ˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼‰
- **é€‚åˆåœºæ™¯**ï¼šç”µä¿¡çº§é›†ç¾¤ã€ä½Žå»¶è¿Ÿé«˜å¯ç”¨ç³»ç»Ÿ

âš ï¸ éš¾ç‚¹ï¼šéƒ¨ç½²å¤æ‚ï¼Œå¯¹ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿ

---

## äº”ã€æ–‡ä»¶ç»“æž„æ±‡æ€»

| å¼•æ“Ž      | æ–‡ä»¶åŽç¼€           | è¯´æ˜Ž                   |
|-----------|--------------------|------------------------|
| InnoDB    | .ibd / .frmï¼ˆæ—§ï¼‰  | æ•°æ® + ç´¢å¼•ï¼ˆç‹¬ç«‹æˆ–å…±äº«è¡¨ç©ºé—´ï¼‰ |
| MyISAM    | .MYD + .MYI + .frm | æ•°æ® + ç´¢å¼• + å®šä¹‰     |
| MEMORY    | æ—                  | æ•°æ®å­˜å†…å­˜ä¸­           |
| ARCHIVE   | .ARZ               | åŽ‹ç¼©æ•°æ®               |
| BLACKHOLE | æ—                  | æ— æ•°æ®å­˜å‚¨             |
| NDB       | åˆ†å¸ƒå¼å­˜å‚¨         | ç”±é›†ç¾¤èŠ‚ç‚¹ç»´æŠ¤         |

---

## å…­ã€å­˜å‚¨å¼•æ“Žé€‰æ‹©å»ºè®®

| åœºæ™¯               | æŽ¨èå¼•æ“Ž      | åŽŸå›                    |
|--------------------|---------------|------------------------|
| äº‹åŠ¡æ€§ç³»ç»Ÿ         | InnoDB        | æ”¯æŒäº‹åŠ¡ä¸Žè¡Œçº§é”       |
| æŠ¥è¡¨ç³»ç»Ÿã€åªè¯»æŸ¥è¯¢ | MyISAM/InnoDB | è¯»æ€§èƒ½é«˜               |
| ä¸´æ—¶ç¼“å­˜ã€ä¼šè¯è¡¨   | MEMORY        | å¿«é€Ÿè¯»å†™               |
| æ—¥å¿—å½’æ¡£           | ARCHIVE       | é«˜åŽ‹ç¼©ã€èŠ‚çœç©ºé—´       |
| ä¸»ä»Žå¤åˆ¶ä¸­è½¬       | BLACKHOLE     | å†™å…¥è§¦å‘ binlog        |
| åˆ†å¸ƒå¼é«˜å¯ç”¨       | NDB Cluster   | å¤šèŠ‚ç‚¹é«˜å¯ç”¨           |

---

## ä¸ƒã€å¿«é€Ÿç¤ºä¾‹

```sql
-- æŸ¥çœ‹æ‰€æœ‰å¼•æ“Ž
SHOW ENGINES;

-- åˆ›å»º InnoDB è¡¨
CREATE TABLE emp (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50),
  age INT
) ENGINE=InnoDB;

-- åˆ›å»º MyISAM è¡¨
CREATE TABLE emp_log (
  id INT AUTO_INCREMENT PRIMARY KEY,
  log_text TEXT
) ENGINE=MyISAM;

-- MEMORY è¡¨ï¼ˆéžæŒä¹…ï¼‰
CREATE TABLE cache_temp (
  id INT,
  value VARCHAR(50)
) ENGINE=MEMORY;

-- æŸ¥çœ‹å½“å‰è¡¨çš„å¼•æ“Ž
SHOW TABLE STATUS LIKE 'emp'\G
```

---

## å…«ã€æ˜“é”™ç‚¹æ€»ç»“

| é”™è¯¯ç‚¹                   | åŽŸå›                     | åŽæžœ           |
|--------------------------|-------------------------|----------------|
| æŠŠäº‹åŠ¡è¡¨å»ºä¸º MyISAM      | MyISAM ä¸æ”¯æŒäº‹åŠ¡       | æ•°æ®ä¸ä¸€è‡´     |
| MEMORY è¡¨å­˜é‡è¦æ•°æ®      | é‡å¯ä¸¢å¤±                | æ•°æ®ä¸¢å¤±       |
| ä¸è°ƒ innodb_buffer_pool_size | é»˜è®¤è¿‡å°            | æ€§èƒ½å·®         |
| è¯¯è®¤ä¸º MyISAM æ”¯æŒå¤–é”®   | ä¸æ”¯æŒ                  | å¤–é”®å¤±æ•ˆ       |
| ä¿®æ”¹å¤§è¡¨å¼•æ“Žæ— å¤‡ä»½       | ALTER TABLE ä¼šå¤åˆ¶æ•´è¡¨  | æ•°æ®é£Žé™©       |

---

## ä¹ã€æ€»ç»“å£è¯€ï¼ˆåŠ©è®°ï¼‰

> InnoDB ç¨³åˆå…¨ï¼ŒMyISAM è¯»å¿«ä½†é”å…¨ï¼›  
> Memory ä¸´æ—¶å­˜ï¼ŒArchive å½’æ¡£ä¸åˆ ï¼›  
> Blackhole é»‘æ´žç©ºï¼ŒNDB é›†ç¾¤å¿™ã€‚

---